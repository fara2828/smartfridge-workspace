import { Request, Response } from 'express';
import axios, {AxiosResponse} from 'axios';
const axios = require('axios');
const connection = require('../config/database');  // Import the connection




// Endpoint for Kakao login
exports.login = async (req, res) => {
  const { ACCESS_TOKEN, requestUserUrl } = req.body;
  try {
    const userResponse = await axios.post(requestUserUrl, {
      headers: {
        Authorization: `Bearer ${ACCESS_TOKEN}`
      }
    });
    const userInfo = userResponse.data;
    console.log(userInfo);

    // Save ACCESS_TOKEN and user info into MySQL
    connection.query('INSERT INTO users SET ?', userInfo, (error, results, fields) => {
      if (error) throw error;
      res.send('User information saved.');
    });

    connection.query('INSERT INTO tokens SET ?', { ACCESS_TOKEN }, (error, results, fields) => {
      if (error) throw error;
    });

  } catch (error) {
    console.log(error);
    res.status(500).send('Internal Server Error');
  }
};
